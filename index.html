<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA IMOBILI√ÅRIO PRIVADO</title>
    <style>
        :root {
            --bg: #09090b; --card: #18181b; --primary: #a855f7;
            --secondary: #22d3ee; --text: #f4f4f5; --input: #27272a;
            --danger: #ef4444; --whatsapp: #22c55e;
        }

        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 12px; margin: 0; }
        .container { max-width: 500px; margin: auto; }
        
        /* Tela de Login */
        #login-screen { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 80vh; text-align: center; 
        }
        
        /* Conte√∫do Principal (Escondido por padr√£o) */
        #main-content { display: none; }

        .card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #27272a; margin-bottom: 20px; }
        
        input, select, textarea { 
            width: 100%; padding: 14px; background: var(--input); border: 1px solid #3f3f46; 
            color: white; border-radius: 12px; box-sizing: border-box; font-size: 16px; margin-bottom: 12px;
        }

        .btn { 
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-zap { background: var(--whatsapp); color: white; margin-top: 10px; }

        .client-card { 
            background: var(--card); padding: 15px; border-radius: 15px; 
            margin-bottom: 12px; border-left: 4px solid var(--primary);
        }
        
        .badge { font-size: 10px; background: #333; padding: 3px 8px; border-radius: 5px; color: var(--secondary); }
        .error { color: var(--danger); font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen">
        <h1 style="color: var(--primary)">üîê Acesso Restrito</h1>
        <p style="color: #888">Digite a senha para ver os clientes</p>
        <input type="password" id="senha-input" placeholder="Senha do Sistema">
        <button class="btn btn-primary" onclick="verificarSenha()">ENTRAR</button>
        <div id="login-erro" class="error"></div>
    </div>

    <div id="main-content">
        <div class="card">
            <h2 style="margin: 0 0 20px 0">üè† Novo Registro</h2>
            <form id="crmForm">
                <input type="text" id="nome" placeholder="Nome do Cliente" required>
                <input type="tel" id="tel" placeholder="WhatsApp (ex: 11999998888)" required>
                <select id="tipo">
                    <option value="Casa">Casa</option>
                    <option value="Apartamento">Apartamento</option>
                    <option value="Granja">Granja</option>
                    <option value="Terreno">Terreno</option>
                </select>
                <textarea id="obs" placeholder="Observa√ß√µes do interesse..."></textarea>
                <button type="submit" class="btn btn-primary">SALVAR CLIENTE</button>
            </form>
        </div>

        <div style="margin-bottom: 15px;">
            <input type="text" id="busca" placeholder="üîç Buscar na sua lista..." onkeyup="renderizar()">
        </div>

        <div id="lista-clientes"></div>
        
        <button class="btn" style="background: #222; margin-top: 20px;" onclick="logout()">SAIR / BLOQUEAR</button>
    </div>
</div>

<script>
    const SENHA_MESTRA = "1234"; // <--- MUDE SUA SENHA AQUI

    // --- SISTEMA DE LOGIN ---
    function verificarSenha() {
        const input = document.getElementById('senha-input').value;
        if(input === SENHA_MESTRA) {
            sessionStorage.setItem('logado', 'true');
            mostrarApp();
        } else {
            document.getElementById('login-erro').innerText = "Senha incorreta!";
        }
    }

    function mostrarApp() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        renderizar();
    }

    function logout() {
        sessionStorage.removeItem('logado');
        window.location.reload();
    }

    // Verifica se j√° estava logado antes
    if(sessionStorage.getItem('logado') === 'true') {
        mostrarApp();
    }

    // --- SISTEMA DE DADOS ---
    const form = document.getElementById('crmForm');

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const nome = document.getElementById('nome').value.trim();
        const tel = document.getElementById('tel').value.replace(/\D/g, "");
        
        let db = JSON.parse(localStorage.getItem('imobi_logs_v4') || '[]');

        // VERIFICA√á√ÉO ANTI-REPETI√á√ÉO
        const existe = db.find(c => c.tel === tel || c.nome.toLowerCase() === nome.toLowerCase());
        if(existe) {
            alert("Aten√ß√£o: Este cliente (ou telefone) j√° est√° cadastrado!");
            return;
        }

        const novoCliente = {
            id: Date.now(),
            nome: nome,
            tel: tel,
            tipo: document.getElementById('tipo').value,
            obs: document.getElementById('obs').value,
            data: new Date().toLocaleDateString('pt-BR')
        };

        db.push(novoCliente);
        localStorage.setItem('imobi_logs_v4', JSON.stringify(db));
        form.reset();
        renderizar();
    });

    function renderizar() {
        const db = JSON.parse(localStorage.getItem('imobi_logs_v4') || '[]');
        const termo = document.getElementById('busca').value.toLowerCase();
        const container = document.getElementById('lista-clientes');
        
        container.innerHTML = '';

        const filtrados = db.slice().reverse().filter(c => 
            c.nome.toLowerCase().includes(termo) || c.tipo.toLowerCase().includes(termo)
        );

        filtrados.forEach(c => {
            const div = document.createElement('div');
            div.className = 'client-card';
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between">
                    <strong>${c.nome}</strong>
                    <span class="badge">${c.tipo}</span>
                </div>
                <p style="font-size: 13px; color: #aaa; margin: 8px 0;">${c.obs}</p>
                <div style="font-size: 11px; color: #555;">Cadastrado em: ${c.data}</div>
                <button class="btn btn-zap" onclick="abrirZap('${c.tel}')">WHATSAPP</button>
                <button onclick="remover(${c.id})" style="background:none; border:none; color:var(--danger); font-size:11px; margin-top:10px; width:100%">Excluir Registro</button>
            `;
            container.appendChild(div);
        });
    }

    function abrirZap(tel) {
        window.open(`https://api.whatsapp.com/send?phone=55${tel}`, '_blank');
    }

    function remover(id) {
        if(confirm("Apagar permanentemente este cliente?")) {
            let db = JSON.parse(localStorage.getItem('imobi_logs_v4'));
            db = db.filter(c => c.id !== id);
            localStorage.setItem('imobi_logs_v4', JSON.stringify(db));
            renderizar();
        }
    }
</script>

</body>
</html>
