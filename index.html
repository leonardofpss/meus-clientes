<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMOBI CRM ELITE V3</title>
    <style>
        :root {
            --bg: #09090b; --card: #18181b; --primary: #a855f7;
            --secondary: #22d3ee; --text: #f4f4f5; --input: #27272a;
            --danger: #ef4444; --whatsapp: #22c55e; --warning: #f59e0b;
        }

        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 12px; margin: 0; }
        .container { max-width: 500px; margin: auto; }
        
        /* Dashboard scroll */
        .stats-wrapper { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .stat-card { background: var(--card); padding: 10px; border-radius: 12px; min-width: 80px; flex: 1; text-align: center; border: 1px solid #27272a; }
        .stat-card p { margin: 4px 0 0; font-size: 18px; font-weight: 800; color: var(--secondary); }
        .stat-card h3 { margin: 0; font-size: 8px; color: #71717a; text-transform: uppercase; }

        /* Form Estilizado */
        .main-card { background: var(--card); padding: 20px; border-radius: 20px; margin-bottom: 20px; border: 1px solid #27272a; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        label { display: block; font-size: 11px; color: #a1a1aa; margin: 10px 0 5px 2px; font-weight: 600; }
        input, select, textarea { 
            width: 100%; padding: 12px; background: var(--input); border: 1px solid #3f3f46; 
            color: white; border-radius: 10px; box-sizing: border-box; font-size: 16px;
        }
        input:focus { border-color: var(--primary); outline: none; }
        
        .btn-save { background: var(--primary); color: white; padding: 16px; width: 100%; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 15px; box-shadow: 0 4px 6px -1px rgba(168, 85, 247, 0.4); }

        /* Filtros e Busca */
        .search-bar { width: 100%; padding: 12px; background: #000; border: 1px solid #27272a; border-radius: 12px; color: white; margin-bottom: 15px; box-sizing: border-box; }

        /* Lista de Leads */
        .client-card { background: var(--card); padding: 16px; border-radius: 16px; margin-bottom: 12px; border-left: 5px solid #3f3f46; position: relative; }
        .status-aguardando { border-left-color: var(--warning); }
        .status-visita { border-left-color: var(--secondary); }
        .status-fechado { border-left-color: var(--whatsapp); }

        .client-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .client-name { font-size: 16px; font-weight: 700; margin: 0; }
        .badge { font-size: 9px; padding: 2px 8px; border-radius: 4px; font-weight: bold; background: #27272a; color: #a1a1aa; }

        .obs-box { font-size: 13px; color: #d1d1d6; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #27272a; }

        .actions-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; }
        .action-btn { padding: 10px 0; border-radius: 8px; border: none; color: white; font-size: 10px; font-weight: bold; text-align: center; cursor: pointer; }
        .bg-zap { background: var(--whatsapp); }
        .bg-call { background: #3b82f6; }
        .bg-edit { background: #52525b; }
        .bg-del { background: var(--danger); opacity: 0.8; }

        .footer-tools { text-align: center; padding: 20px; opacity: 0.5; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="stats-wrapper">
        <div class="stat-card"><h3>Total</h3><p id="st-total">0</p></div>
        <div class="stat-card"><h3>Casas</h3><p id="st-casas">0</p></div>
        <div class="stat-card"><h3>Aptos</h3><p id="st-aptos">0</p></div>
        <div class="stat-card"><h3>Granjas</h3><p id="st-granjas">0</p></div>
        <div class="stat-card"><h3>Terr.</h3><p id="st-terrenos">0</p></div>
    </div>

    <div class="main-card">
        <h2 id="title" style="margin:0; font-size:18px">âœ¨ Novo Lead</h2>
        <form id="crmForm">
            <input type="hidden" id="editId">
            <label>NOME DO CLIENTE</label>
            <input type="text" id="nome" placeholder="Nome completo" required>
            
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label>WHATSAPP</label>
                    <input type="tel" id="tel" placeholder="DDD + NÃºmero" required>
                </div>
                <div style="flex: 1;">
                    <label>STATUS</label>
                    <select id="status">
                        <option value="aguardando">ðŸŸ¡ Aguardando</option>
                        <option value="visita">ðŸ”µ Visita Marcada</option>
                        <option value="fechado">ðŸŸ¢ Venda Fechada</option>
                    </select>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label>TIPO IMÃ“VEL</label>
                    <select id="tipo">
                        <option value="Casa">Casa</option>
                        <option value="Apartamento">Apto</option>
                        <option value="Granja">Granja</option>
                        <option value="Terreno">Terreno</option>
                    </select>
                </div>
            </div>

            <label>OBSERVAÃ‡Ã•ES</label>
            <textarea id="obs" rows="2" placeholder="Local, valor, perfil..."></textarea>
            
            <button type="submit" class="btn-save" id="btnS">SALVAR CLIENTE</button>
            <button type="button" id="btnC" style="display:none; color:white; background:none; border:none; width:100%; margin-top:10px" onclick="cancelar()">Cancelar</button>
        </form>
    </div>

    <input type="text" id="busca" class="search-bar" placeholder="ðŸ” Pesquisar por nome..." onkeyup="render()">

    <div id="lista"></div>

    <div class="footer-tools">
        CRM ImobiliÃ¡rio v3.0 | <span onclick="exportar()">Baixar Backup</span>
    </div>
</div>

<script>
    const form = document.getElementById('crmForm');

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('editId').value;
        const novo = {
            id: id ? parseInt(id) : Date.now(),
            nome: document.getElementById('nome').value,
            tel: document.getElementById('tel').value.replace(/\D/g, ""),
            status: document.getElementById('status').value,
            tipo: document.getElementById('tipo').value,
            obs: document.getElementById('obs').value,
            data: new Date().toLocaleDateString('pt-BR')
        };

        let db = JSON.parse(localStorage.getItem('imobi_v3') || '[]');
        if(id) { db = db.map(c => c.id == id ? novo : c); cancelar(); } 
        else { db.push(novo); }
        
        localStorage.setItem('imobi_v3', JSON.stringify(db));
        form.reset();
        render();
    });

    function render() {
        const db = JSON.parse(localStorage.getItem('imobi_v3') || '[]');
        const termo = document.getElementById('busca').value.toLowerCase();
        
        document.getElementById('st-total').innerText = db.length;
        document.getElementById('st-casas').innerText = db.filter(c => c.tipo === 'Casa').length;
        document.getElementById('st-aptos').innerText = db.filter(c => c.tipo === 'Apartamento').length;
        document.getElementById('st-granjas').innerText = db.filter(c => c.tipo === 'Granja').length;
        document.getElementById('st-terrenos').innerText = db.filter(c => c.tipo === 'Terreno').length;

        const listaDiv = document.getElementById('lista');
        listaDiv.innerHTML = db.slice().reverse().filter(c => c.nome.toLowerCase().includes(termo)).map(c => `
            <div class="client-card status-${c.status}">
                <div class="client-header">
                    <div>
                        <p class="client-name">${c.nome}</p>
                        <span class="badge">${c.tipo.toUpperCase()}</span>
                    </div>
                    <span style="font-size:10px; color:#52525b">${c.data}</span>
                </div>
                <div class="obs-box">${c.obs || 'Nenhuma observaÃ§Ã£o.'}</div>
                <div class="actions-grid">
                    <button class="action-btn bg-zap" onclick="zap('${c.tel}', '${c.nome}')">ZAP</button>
                    <button class="action-btn bg-call" onclick="window.location.href='tel:${c.tel}'">LIGAR</button>
                    <button class="action-btn bg-edit" onclick="editar(${c.id})">EDIT</button>
                    <button class="action-btn bg-del" onclick="apagar(${c.id})">SAIR</button>
                </div>
            </div>
        `).join('');
    }

    function zap(tel, nome) {
        window.open(`https://api.whatsapp.com/send?phone=55${tel}&text=OlÃ¡ ${nome}, tudo bem?`, '_blank');
    }

    function editar(id) {
        const db = JSON.parse(localStorage.getItem('imobi_v3'));
        const c = db.find(i => i.id == id);
        document.getElementById('editId').value = c.id;
        document.getElementById('nome').value = c.nome;
        document.getElementById('tel').value = c.tel;
        document.getElementById('status').value = c.status;
        document.getElementById('tipo').value = c.tipo;
        document.getElementById('obs').value = c.obs;
        document.getElementById('title').innerText = "ðŸ“ Editando";
        document.getElementById('btnS').innerText = "ATUALIZAR";
        document.getElementById('btnC').style.display = "block";
        window.scrollTo({top:0, behavior:'smooth'});
    }

    function cancelar() {
        document.getElementById('editId').value = "";
        document.getElementById('title').innerText = "âœ¨ Novo Lead";
        document.getElementById('btnS').innerText = "SALVAR CLIENTE";
        document.getElementById('btnC').style.display = "none";
        form.reset();
    }

    function apagar(id) {
        if(confirm("Remover cliente?")) {
            let db = JSON.parse(localStorage.getItem('imobi_v3'));
            localStorage.setItem('imobi_v3', JSON.stringify(db.filter(i => i.id != id)));
            render();
        }
    }

    function exportar() {
        const data = localStorage.getItem('imobi_v3');
        const blob = new Blob([data], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'backup_imobi.txt';
        a.click();
    }

    render();
</script>

</body>
</html>
